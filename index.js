"use strict";function talk(e){console.log(e);var t=new jtalk,r=function a(e){var r=arguments[1]||0;e.length<r+1||t.talk(e[r],function(t){t&&console.log("err",t),a(e,++r)})};r(e)}function createAreaText(e){var t=[];return t.push(e("title").text().match(/(.+)の天気/)[0]+"予報です。"),t}function createRealtimeWeatherText(e,t,r){var a=[];t&&a.push(t);var n=e(".RankArrow.MaxCurrent"),o=void 0;return n.length?(o=getWeather(n.parents(".LWbtn")),a.push("只今、"+n.text()+"の人が「"+o+"」と呟いてます。")):!function(){var t=[],r=void 0;t.push("只今、"),e(".RankArrow").each(function(){o=getWeather(e(this).parents(".LWbtn")),t.push(e(this).text()+"の人が「"+o+"」"),r+=parseInt(e(this).text(),10)}),t.push("と呟いてます。"),r>0?a.push(t.join("")):a.push("残念ながら、実況者がおりませんでした。")}(),r&&a.push(r),a}function getWeather(e){var t="";switch(e.attr("id")){case"sunBtn":t="晴れ";break;case"cloudsBtn":t="曇り";break;case"rainBtn":t="雨";break;case"snowBtn":t="雪";break;default:console.error("dom has changed!")}return t}function createWeatherText(e,t,r){var a=getRawWeatherData(e.find(".yjw_table2")),n=[];t&&n.push(t);var o=e.find("h3 span").text().replace(" - ","").replace(/\((.+?)\)/,"($1曜日)");n.push(o);var i=[];if(Object.keys(a).forEach(function(e){var t=a[e],r=t[0].replace(/[\n\r]/g,""),o=t[1].replace(/[\n\r]/g,""),u=t[2],h=t[3],p=t[4],s=t[5].split(/[\n\r]/g);s[0],s[1];parseInt(p,10)>0?n.push(r+"、"+o+"、気温は"+u+"度、湿度は"+h+"％、降水量は"+p+"ミリメートルです。'"):n.push(r+"、"+o+"、気温は"+u+"度、湿度は"+h+"％です。"),i.push({time:r,tempature:u})}),i=i.sort(function(e,t){var r=e.tempature,a=t.tempature;return r>a?1:a>r?-1:0}),i.length>1){var u=i[0],h=i[i.length-1];n.push("最低気温は"+u.time+"の"+u.tempature+"度です。"),n.push("最高気温は"+h.time+"の"+h.tempature+"度です。")}return r&&n.push(r),n}function getRawWeatherData(e){var t={};return e.each(function(){$(this).find("tr").eq(0).each(function(){$(this).find("td").each(function(e,r){"#e9eefd"===$(this).attr("bgcolor")&&(t[e]=[])})})}),e.each(function(){$(this).find("tr").each(function(){var e=$(this).find("td");Object.keys(t).forEach(function(r){t[r].push(e.eq(r).text())})})}),t}var request=require("request"),cheerio=require("cheerio"),jtalk=require("openjtalk"),$=void 0,arg=process.argv,url="http://weather.yahoo.co.jp/weather/jp/14/4610/14133.html";arg.some(function(e){return/^http/.test(e)?(url=e,!0):void 0}),request({method:"GET",url:url},function(e,t,r){if(e)return console.error(e);$=cheerio.load(r);var a=$("#yjw_pinpoint_today"),n=$("#yjw_pinpoint_tomorrow"),o=[],i=createAreaText($);Array.prototype.push.apply(o,i);var u=-1===arg.indexOf("now")&&-1===arg.indexOf("today")&&-1===arg.indexOf("tomorrow");if(-1!==arg.indexOf("now")||u){var h=createRealtimeWeatherText($,"","");Array.prototype.push.apply(o,h)}if(-1!==arg.indexOf("today")||u){var p=createWeatherText(a,"このあとの天気予報をお知らせします。","以上、今日の天気予報をお知らせしました。");Array.prototype.push.apply(o,p)}if(-1!==arg.indexOf("tomorrow")||u){var s=createWeatherText(n,"明日の天気予報をお知らせします。","以上、明日の天気予報をお知らせしました。");Array.prototype.push.apply(o,s)}talk(o)});