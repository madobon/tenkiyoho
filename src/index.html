<html>
  <head>
    <meta charset="utf-8">
    <style>
      body {
        font-family: "Helvetica Neue", helvetica, arial;
        padding: 15px;
      }

      ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      ul li {
        line-height: 1.4;
      }
    </style>
  </head>
  <body>
    <select id="extension" class="" name="">
      <option value="http://weather.yahoo.co.jp/weather/jp/14/4610/14102.html">横浜市神奈川区</option>
      <option value="http://weather.yahoo.co.jp/weather/jp/14/4610/14133.html">川崎市中原区</option>
      <option value="http://weather.yahoo.co.jp/weather/jp/14/4610/14114.html">横浜市瀬谷区</option>
      <option value="http://weather.yahoo.co.jp/weather/jp/14/4610/14213.html">大和市</option>
    </select>
    <input type="button" id="button-now" value="現在"/>
    <input type="button" id="button-today" value="これから"/>
    <input type="button" id="button-tommorow" value="明日"/>
    <ul id="res-message"></ul>
  </body>
  <script>


    var selectbox = document.querySelector('#extension');

    var host = location.origin.replace(/^http/, 'ws')
    var ws = new WebSocket(host);

    ws.onopen = function () {
      console.info('connected');
    };

    ws.onmessage = function (event) {
      var li = document.createElement('li');
      li.innerHTML = JSON.parse(event.data);
      document.querySelector('#res-message').appendChild(li);
    };

    document.querySelector('#button-now').addEventListener('click', function(e){
      send({args: ['now']});
    }, false);

    document.querySelector('#button-today').addEventListener('click', function(e){
      send({args: ['today']});
    }, false);

    document.querySelector('#button-tommorow').addEventListener('click', function(e){
      send({args: ['tomorrow']});
    }, false);

    function send(object) {
      object.url = selectbox.options[selectbox.selectedIndex].value;
      ws.send(JSON.stringify(object));
    }
  </script>
</html>
